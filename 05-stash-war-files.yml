---
- name: Transfer WAR files
  hosts: g1, g2
  tasks:
    - name: Ensure source directory exists
      ansible.builtin.file:
        path: /home/centos/mid-project-calculator/target/
        state: directory
      become: yes
      delegate_to: g1 # This delegates the task to host g1

    - name: Ensure destination directory exists on g2
      ansible.builtin.file:
        path: /opt/tomcat/webapps/
        state: directory
      become: yes
      delegate_to: g2  # This delegates the task to host g2

    - name: Synchronize WAR files to destination
      ansible.builtin.synchronize:
        src: /home/centos/mid-project-calculator/target/
        dest: /opt/tomcat/webapps/
        rsync_opts: --include='*.war' --exclude='*'
      become: yes

- name: Ensure Tomcat directory exists
  hosts: g2
  tasks:
    - name: Ensure Tomcat directory exists
      ansible.builtin.file:
        path: /opt/tomcat/webapps/
        state: directory
      become: yes

    - name: Set permissions for Tomcat directory
      ansible.builtin.file:
        path: /opt/tomcat/webapps/
        mode: '0755'
      when: "'0755' != (item.stat.mode | regex_replace('(\\d{3})$', '\\1'))"
      loop: "{{ ansible_play_batch }}"
      become: yes
...