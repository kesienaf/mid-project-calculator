---
- name: Copy File to Another Server
  hosts: g1
  tasks:
    - name: Debug - List files in the source directory
      ansible.builtin.shell:
        cmd: "ls -l /home/centos/mid-project-calculator/target/*.war"
      register: ls_output
      changed_when: false

    - debug:
        var: ls_output.stdout_lines

    - name: Copy files to control node
      ansible.builtin.shell:
        cmd: "rsync -a /home/centos/mid-project-calculator/target/*.war /tmp/fetched_files/"
      args:
        executable: /bin/bash
      register: rsync_output

    - name: Debug - List files in the control node directory
      ansible.builtin.shell:
        cmd: "ls -l /tmp/fetched_files"
      changed_when: false

    - debug:
        var: rsync_output

- name: Template and Copy File to Destination Server
  hosts: g2
  tasks:
    - name: Ensure the destination directory exists
      ansible.builtin.file:
        path: /opt/tomcat/webapps/
        state: directory

    - name: Template the file
      ansible.builtin.template:
        src: /tmp/fetched_files/{{ item }}
        dest: /opt/tomcat/webapps/{{ item | basename }}
      with_fileglob:
        - /tmp/fetched_files/*.war  # Adjust the file type as needed

    - name: Clean up temporary files
      ansible.builtin.file:
        path: /tmp/fetched_files
        state: absent
...